// Generated by CoffeeScript 1.7.1
(function() {
  var App,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  App = angular.module('App', ['ngAnimate', 'ngCookies']);

  App.config(function($httpProvider) {
    return $httpProvider.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
  });

  App.controller('base', function($rootScope, $scope) {
    $rootScope.slidePageUrl = '';
    $rootScope.closePage = function(event) {
      if ($rootScope.slidePageUrl === '') {
        return;
      }
      $rootScope.slidePageUrl = '';
    };
    $scope.btnNavText = function() {
      if ($scope.showNav) {
        return '✕';
      } else {
        return 'N';
      }
    };
    $scope.$on('$includeContentRequested', function() {
      return $scope.loading = true;
    });
    return $scope.$on('$includeContentLoaded', function() {
      return $scope.loading = false;
    });
  });

  App.directive('turbolink', function($http, $rootScope, $document) {
    return {
      restrict: 'A',
      scope: false,
      link: function(scope, element, attrs) {
        element.on('click', function(event) {
          event.preventDefault();
          if ($rootScope.slidePageUrl !== '') {
            return;
          }
          event.stopPropagation();
          $rootScope.slidePageUrl = attrs.href;
          return scope.$digest();
        });
      }
    };
  });

  App.directive('foldList', function($cookieStore) {
    return {
      restrict: 'A',
      scope: false,
      link: function(scope, element, attrs) {
        var fold, foldStore, id, li, open;
        li = element.find('li');
        if (li.length === 0) {
          return;
        }
        foldStore = $cookieStore.get('foldStore') || [];
        id = attrs.foldList;
        open = __indexOf.call(foldStore, id) >= 0;
        fold = angular.element('<fold>▾</fold>');
        element.append(fold);
        if (open === false) {
          element.addClass('fold');
          fold.text('▸');
        }
        element.find('fold').on('click', function() {
          open = !open;
          if (open === false) {
            foldStore.pop(id);
            element.addClass('fold');
            fold.text('▸');
          } else {
            foldStore.push(id);
            element.removeClass('fold');
            fold.text('▾');
          }
          scope.$apply(function() {
            return $cookieStore.put('foldStore', foldStore);
          });
        });
      }
    };
  });

}).call(this);
