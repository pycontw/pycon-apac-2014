// Generated by CoffeeScript 1.7.1
(function() {
  var App,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  App = angular.module('App', ['ngAnimate', 'ngCookies']);

  App.config(function($httpProvider) {
    return $httpProvider.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
  });

  App.controller('base', function($rootScope, $scope) {
    $rootScope.slidePageUrl = '';
    $rootScope.closePage = function(event) {
      if ($rootScope.slidePageUrl === '') {
        return;
      }
      $rootScope.slidePageUrl = '';
    };
    $scope.btnNavText = function() {
      if ($scope.showNav) {
        return '✕';
      } else {
        return 'N';
      }
    };
    $scope.$on('$includeContentRequested', function() {
      return $scope.loading = true;
    });
    return $scope.$on('$includeContentLoaded', function() {
      return $scope.loading = false;
    });
  });

  App.directive('turbolink', function($http, $rootScope, $document) {
    return {
      restrict: 'A',
      scope: false,
      link: function(scope, element, attrs) {
        element.on('click', function(event) {
          event.preventDefault();
          if ($rootScope.slidePageUrl !== '') {
            return;
          }
          event.stopPropagation();
          $rootScope.slidePageUrl = attrs.href;
          return scope.$digest();
        });
      }
    };
  });

  App.directive('foldList', function($cookieStore) {
    return {
      restrict: 'A',
      scope: false,
      link: function(scope, element, attrs) {
        var fold, foldArray, foldIcon, id, isFold, li, unfold;
        li = element.find('li');
        if (li.length === 0) {
          return;
        }
        foldArray = $cookieStore.get('foldArray') || [];
        id = attrs.foldList;
        isFold = __indexOf.call(foldArray, id) >= 0;
        foldIcon = angular.element('<fold>▾</fold>');
        element.append(foldIcon);
        fold = function() {
          element.addClass('fold');
          return foldIcon.text('▸');
        };
        unfold = function() {
          element.removeClass('fold');
          return foldIcon.text('▾');
        };
        if (isFold === true) {
          fold();
        }
        element.find('fold').on('click', function() {
          isFold = !isFold;
          if (isFold === true) {
            foldArray.push(id);
            fold();
          } else {
            foldArray.pop(id);
            unfold();
          }
          scope.$apply(function() {
            return $cookieStore.put('foldArray', foldArray);
          });
        });
      }
    };
  });

}).call(this);
